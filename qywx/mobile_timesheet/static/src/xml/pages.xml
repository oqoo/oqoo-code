<?xml version="1.0" encoding="UTF-8"?>
<!-- vim:fdl=1:
-->
<templates id="template" xml:space="preserve">

<t t-name="mobile_timesheet.page1">
	<div data-role="content" class="ui-content">
		<div data-oextype="calendar" data-model="mobile_timesheet.sheet" data-fields="date,work,status" data-datefield="date"
			data-celltemplate="mobile_timesheet.page1_cell" data-context='{"group_by": ["date:day","status"]}'>
			<div data-role="calendar" data-display-nl="false" t-att-data-end-day="utils.date_to_str(new Date())" data-confirm-text="填工时"></div>
		</div>
	</div>
</t>
<t t-name="mobile_timesheet.page1_cell">
	<div t-if="record.work>0" t-att-class="'status ' + (record.status == 'approved' ? 's2' : (record.status == 'review' ? 's1' : 's4'))"></div>
</t>

<t t-name="mobile_timesheet.page2">
	<div data-role="content" class="ui-content">
		<form data-oextype="listform" data-model="mobile_timesheet.sheet" data-rowtemplate="mobile_timesheet.page2_formlist"
			data-fields="id,sheet_id,date,project,work,reated_work,status" t-att-data-domain='"[[\"date\", \"in\", [\"" + widget.pagecontext.get("data").join("\",\"") + "\"]]]"'>
			<div class="oex-list-wrapper"></div>
		</form>
	</div>
	<div data-role="footer" data-position="fixed" class="bottomBtnBar">
		<button type="button" class="oex_button_save" data-inline="true" data-context='{"opertype":0}'>保存</button>
		<button type="button" class="oex_button_save" data-inline="true" data-context='{"opertype":1, "force":true}'>送审</button>
	</div>
</t>
<t t-name="mobile_timesheet.page2_formlist">
	<t t-set="flag" t-value="0" />
	<t t-foreach="records" t-as="record">
		<t t-if="record.status != 'approved' and record.status != 'review'" t-set="flag" t-value="1" />
	    <li t-if="record.status != 'approved' and record.status != 'review'" class="oex-list-row" t-att-data-id="record.id">
		    <input data-fieldtype="id" type="hidden" name="id" t-att-value="record.id" />
		    <input data-fieldtype="text" type="hidden" name="sheet_id" t-att-value="record.sheet_id" />
		    <input data-fieldtype="text" type="hidden" name="date" t-att-value="record.date" />
		    <input data-fieldtype="text" type="hidden" name="reated_work" t-att-value="record.reated_work" />
		    <div class="ui-field-contain">
			    <label for="project">项目归属</label>
			    <select data-fieldtype="select" name="project" data-model="mobile_timesheet.project"/>
			</div>
		    <div class="ui-field-contain">
			    <label for="work"><t t-esc="record.date" /></label>
			    <input data-fieldtype="text" type="number" name="work" t-att-value="record.work" 
			    	data-msg-max="工时不能超过{0}小时" data-msg-number="工时必须是数字" t-att-max="record.reated_work or 8"/>
			</div>
	    </li>
	    <li t-if="record.status == 'approved' or record.status == 'review'" class="oex-list-row" t-att-data-id="record.id">
		    <div class="ui-field-contain">
			    <label>项目归属</label>
			    <div style="margin:0.5em;float:right;width:51%;"><t t-esc="record.project[1]"/></div>
			</div>
		    <div class="ui-field-contain">
			    <label><t t-esc="record.date" /></label>
			    <div style="margin:0.5em;float:right;width:51%;"><t t-esc="record.work"/></div>
			</div>
	    </li>
    </t>
    <t t-if="flag==0" t-js="d">$("#page2 .bottomBtnBar").hide();</t>
</t>

<t t-name="mobile_timesheet.page3">
	<div data-role="content" class="ui-content">
		<form data-oextype="listform" data-model="mobile_timesheet.sheet" data-rowtemplate="mobile_timesheet.page3_formlist"
			t-att-data-fields='"id,sheet_id,{\"date\":{\"default\":\"" + widget.pagecontext.get("data") + "\"}},project,work,reated_work,status"'
			t-att-data-domain='"[[\"date\", \"=\", \"" + widget.pagecontext.get("data") + "\"]]"'>
			<div class="oex-list-wrapper"></div>
			<button type="button" class="oex_button_new">＋ 新增项目归属</button>
		</form>
	</div>
	<div data-role="footer" data-position="fixed" class="bottomBtnBar">
		<button type="button" class="oex_button_save" data-inline="true" data-context='{"opertype":0}'>保存</button>
		<button type="button" class="oex_button_save" data-inline="true" data-context='{"opertype":1,"force":true}'>送审</button>
	</div>
</t>
<t t-name="mobile_timesheet.page3_formlist">
	<t t-foreach="records" t-as="record">
	    <li t-if="record.status != 'approved' and record.status != 'review'" class="oex-list-row" t-att-data-id="record.id">
		    <input data-fieldtype="id" type="hidden" name="id" t-att-value="record.id" />
		    <input data-fieldtype="text" type="hidden" name="sheet_id" t-att-value="record.sheet_id" />
		    <input data-fieldtype="text" type="hidden" name="date" t-att-value="record.date" />
		    <input data-fieldtype="text" type="hidden" name="reated_work" t-att-value="record.reated_work" />
		    <i t-if="! record.id" class="delete oex_button_delete"></i>
		    <div class="ui-field-contain">
			    <label for="project">项目归属</label>
			    <select data-fieldtype="select" name="project" data-model="mobile_timesheet.project"/>
			</div>
		    <div class="ui-field-contain">
			    <label for="work">工时</label>
			    <input data-fieldtype="text" type="number" name="work" t-att-value="record.work" 
			    	data-msg-max="工时不能超过{0}小时" data-msg-number="工时必须是数字" t-att-max="record.reated_work or 8"/>
			</div>
	    </li>
	    <li t-if="record.status == 'approved' or record.status == 'review'" class="oex-list-row" t-att-data-id="record.id">
		    <div class="ui-field-contain">
			    <label>项目归属</label>
			    <div style="margin:0.5em;float:right;width:51%;"><t t-esc="record.project[1]"/></div>
			</div>
		    <div class="ui-field-contain">
			    <label>工时</label>
			    <div style="margin:0.5em;float:right;width:51%;"><t t-esc="record.work"/></div>
			</div>
	    </li>
    </t>
    <t t-if="records.length>0 and (records[0].status=='approved' or records[0].status=='review')" t-js="d">
    	$("#page3 .bottomBtnBar").hide();
    	$("#page3 .oex_button_new").hide();
    </t>
</t>

<t t-name="mobile_timesheet.page4">
	<div data-role="content" class="ui-content">
		<div data-oextype="monthview" data-role="monthview" data-model="mobile_timesheet.sheet" data-fields="date,work"
			data-celltemplate="mobile_timesheet.page4_cell" data-datefield="date" t-att-data-end-month="utils.date_to_str(new Date()).substring(0,7)"
			data-context='{"group_by": ["date:month"]}'>
		</div>
	</div>
</t>
<t t-name="mobile_timesheet.page4_cell">
	<!-- <span class="days"></span>天&nbsp; --><span class="hours"><t t-esc="record.work" /></span>小时
</t>

<t t-name="mobile_timesheet.page5">
	<div data-role="content" class="ui-content">
		<div data-oextype="list" data-rowtemplate="mobile_timesheet.page5_list1" data-model="mobile_timesheet.sheet" data-fields="date,work,reated_work,status"
			t-att-data-domain='"[[\"date\", \"&gt;=\", \"" + widget.pagecontext.get("fromdate") + "\"],[\"date\", \"&lt;=\", \"" + widget.pagecontext.get("todate") + "\"]]"'
			data-context='{"group_by": ["date:day","status"]}' class="oex-list-wrapper">
		</div>
	</div>
</t>
<t t-name="mobile_timesheet.page5_list1" t-foreach="records" t-as="record">
    <li class="oex-list-row" t-att-data-id="record.id">
    	<div data-role="xprogressbar" t-att-data-front-label="record.date.substring(5)"
    		t-att-data-last-label="'&lt;span&gt;' + record.work + '&lt;/span&gt;/' + (record.reated_work?record.reated_work:8)"
    		t-att-data-bar-color="(record.status == 'approved' ? '#389e27' : (record.status == 'review' ? '#ea3838' : (record.status?'#cccccc':'')))"
    		t-att-data-progress="record.work/(record.reated_work?record.reated_work:8)*100"></div>
    </li>
</t>

</templates>

